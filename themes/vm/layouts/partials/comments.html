{{ if .Site.Params.giscus.enable }}
<div style="margin-top:3rem; padding-top:2rem; border-top:1px solid #f0f0f0;">
  <h4 style="margin:0 0 1.5rem 0; font-size:1.1rem; color:#555; font-weight:500;">Comments</h4>
  <script src="https://giscus.app/client.js"
          data-repo="{{ .Site.Params.giscus.repo }}"
          data-repo-id="{{ .Site.Params.giscus.repoId }}"
          data-category="{{ .Site.Params.giscus.category }}"
          data-category-id="{{ .Site.Params.giscus.categoryId }}"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="light"
          data-lang="en"
          crossorigin="anonymous"
          async>
  </script>
  <script>
    // Update Giscus theme when site theme changes
    function updateGiscusTheme() {
      const theme = localStorage.getItem('theme') || 'light';
      const giscusTheme = theme === 'dark' ? 'dark' : 'light';
      
      // Wait for giscus to load and then update theme
      const giscusFrame = document.querySelector('iframe[src*="giscus"]');
      if (giscusFrame) {
        const message = {
          setConfig: {
            theme: giscusTheme
          }
        };
        giscusFrame.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
    }
    
    // Apply theme immediately when comments load
    document.addEventListener('DOMContentLoaded', function() {
      // Set initial theme
      setTimeout(updateGiscusTheme, 1000);
      
      // Listen for theme toggle clicks
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          setTimeout(updateGiscusTheme, 100);
        });
      }
    });
  </script>
</div>
{{ end }}
